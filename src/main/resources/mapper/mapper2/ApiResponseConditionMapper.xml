<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.qydata.mapper.mapper2.ApiResponseConditionMapper">

    <resultMap id="ApiResponseCondition_Map" type="org.qydata.dst.ApiResponseCondition">
        <result column="apiId" property="apiId"/>
        <result column="apiTypeId" property="apiTypeId"/>
        <result column="subTypeId" property="subTypeId"/>
        <result column="apiTypeName" property="apiTypeName"/>
        <result column="subTypeName" property="subTypeName"/>
        <result column="vendorName" property="vendorName"/>
        <result column="totalCount" property="totalCount"/>
        <result column="successCount" property="successCount"/>
        <result column="failCount" property="failCount"/>
        <result column="count1" property="count1"/>
        <result column="count2" property="count2"/>
        <result column="count3" property="count3"/>
        <result column="count4" property="count4"/>
        <result column="count5" property="count5"/>
        <result column="count6" property="count6"/>
        <result column="count7" property="count7"/>
        <result column="dateTime" property="dateTime"/>
    </resultMap>


    <select id="queryApiResponseCondition" parameterType="map" resultMap="ApiResponseCondition_Map">

        SELECT
            a.apiId,
            a.apiTypeId,
            a.subTypeId,
            b.apiTypeName,
            b.mobileOperatorName subTypeName,
            b.vendorName,
            sum(totalCount) totalCount,
            sum(successCount) successCount,
            sum(failCount) failCount,
            sum(count1) count1,
            sum(count2) count2,
            sum(count3) count3,
            sum(count4) count4,
            sum(count5) count5,
            sum(count6) count6,
            sum(count7) count7,
            DATE_FORMAT(a.cycle,'%Y-%m-%d') dateTime
        FROM
            qyfinance.apiResponseConditionCountByHour a
        LEFT JOIN
            qyfinance.bkvw_api_ApiTypeVendorPartner b
        ON
            a.apiId = b.apiId
        LEFT JOIN
            qyfinance.bkvwMobileOperator c
        ON
            b.mobileOperatorId = c.id
        WHERE
            a.apiId = #{apiId}
        GROUP BY
            DATE_FORMAT(a.cycle,'%Y-%m-%d'),a.apiId,a.apiTypeId,a.subTypeId
        ORDER BY
			DATE_FORMAT(a.cycle,'%Y-%m-%d')DESC
		LIMIT 10

    </select>


    <select id="queryAllApiResponse" parameterType="map" resultMap="ApiResponseCondition_Map">

        SELECT
        a.apiId,
        a.apiTypeId,
        a.subTypeId,
        b.apiTypeName,
        b.mobileOperatorName subTypeName,
        b.vendorName,
        sum(totalCount)
        FROM
        qyfinance.apiResponseConditionCountByHour a
        LEFT JOIN qyfinance.bkvw_api_ApiTypeVendorPartner b ON a.apiId = b.apiId
        LEFT JOIN qyfinance.bkvwMobileOperator c ON b.mobileOperatorId = c.id
        WHERE
        <if test="monthBeforeCurrent != null and monthBeforeCurrent != ''" >
            a.cycle >= #{monthBeforeCurrent}
        </if>
        <if test="currTime != null and currTime != ''" >
            <![CDATA[
                AND  a.cycle < #{currTime}
            ]]>
        </if>
        GROUP BY
        a.apiId,
        a.apiTypeId,
        a.subTypeId
        ORDER BY
        sum(totalCount) DESC

    </select>

</mapper>

